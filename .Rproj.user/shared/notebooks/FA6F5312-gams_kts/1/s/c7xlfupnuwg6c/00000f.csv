"0","sm2 <- smoothCon(s(x, k = k, bs = ""cr""), data = data, knots = knots)[[1]]$X"
"0","beta <- coef(lm(ycent ~ sm2 - 1, data = data))"
"0","wtbasis <- sweep(sm2, 2L, beta, FUN = ""*"")"
"0","colnames(wtbasis) <- colnames(sm2) <- paste0(""F"", seq_len(k))"
"0","## create stacked unweighted and weighted basis"
"0","basis <- as_tibble(rbind(sm2, wtbasis)) %>%"
"0","    add_column(x = rep(data$x, times = 2),"
"0","               type = rep(c('unweighted', 'weighted'), each = nrow(sm2)),"
"0","               .before = 1L)"
"0","##data <- cbind(data, fitted = rowSums(scbasis))"
"0","wtbasis <- as_tibble(rbind(sm2, wtbasis)) %>%"
"0","    add_column(x      = rep(data$x, times = 2),"
"0","               fitted = rowSums(.),"
"0","               type   = rep(c('unweighted', 'weighted'), each = nrow(sm2))) %>%"
"0","    pivot_longer(-(x:type), names_to = 'bf')"
"0","basis <- pivot_longer(basis, -(x:type), names_to = 'bf')"
"0",""
"0","p3 <- ggplot(data, aes(x = x, y = ycent)) +"
"0","    geom_point(aes(y = yobs), alpha = 0.2) +"
"0","    geom_line(data = basis,"
"0","              mapping = aes(x = x, y = value, colour = bf),"
"0","              lwd = 1, alpha = 0.5) +"
"0","    geom_line(data = wtbasis,"
"0","              mapping = aes(x = x, y = fitted), lwd = 1, colour = 'black', alpha = 0.75) +"
"0","    guides(colour = FALSE) +"
"0","    labs(y = 'f(x)', x = 'x') +"
"0","    theme_minimal(base_size = 16, base_family = 'firasans')"
"0",""
"0","# crs_fit <- animate(p3 + transition_states(type, transition_length = 4, state_length = 2) + "
"0","#                    ease_aes('cubic-in-out'), renderer = gifski_renderer(file = './resources/gam-crs-animation.gif'),"
"0","#                    nframes = 100, height = anim_height, width = anim_width, res = anim_res,"
"0","#                    dev = anim_dev)"
"0",""
"0","# anim_save('./resources/gam-crs-animation.gif', crs_fit)"
