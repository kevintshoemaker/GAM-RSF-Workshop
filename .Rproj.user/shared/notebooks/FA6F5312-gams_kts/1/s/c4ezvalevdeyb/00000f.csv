"0",""
"0","    # true function- highly non-linear relationship"
"0","f <- function(x) {"
"0","    x^11 * (10 * (1 - x))^6 + ((10 * (10 * x)^3) * (1 - x)^10)"
"0","}"
"0",""
"0","draw_beta <- function(n, k, mu = 1, sigma = 1) {"
"0","    rmvn(n = n, mu = rep(mu, k), sigma = diag(rep(sigma, k)))"
"0","}"
"0",""
"0","weight_basis <- function(bf, x, n = 1, k, ...) {"
"0","    beta <- draw_beta(n = n, k = k, ...)"
"0","    out <- sweep(bf, 2L, beta, '*')"
"0","    colnames(out) <- paste0('f', seq_along(beta))"
"0","    out <- as_tibble(out)"
"0","    out <- add_column(out, x = x)"
"0","    out <- pivot_longer(out, -x, names_to = 'bf', values_to = 'y')"
"0","    out"
"0","}"
"0",""
"0","random_bases <- function(bf, x, draws = 10, k, ...) {"
"0","    out <- map(1:draws, \(i) weight_basis(bf, x = x, k = k, ...))"
"0","    out <- bind_rows(out)"
"0","    out <- add_column(out, draw = rep(seq_len(draws), each = length(x) * k),"
"0","                      .before = 1L)"
"0","    class(out) <- c(""random_bases"", class(out))"
"0","    out"
"0","}"
"0",""
"0","plot.random_bases <- function(x, facet = FALSE) {"
"0","    plt <- ggplot(x, aes(x = x, y = y, colour = bf)) +"
"0","        geom_line(lwd = 1, alpha = 0.75) +"
"0","        guides(colour = FALSE)"
"0","    if (facet) {"
"0","        plt + facet_wrap(~ draw)"
"0","    }"
"0","    plt"
"0","}"
"0",""
"0","normalize <- function(x) {"
"0","    rx <- range(x)"
"0","    z <- (x - rx[1]) / (rx[2] - rx[1])"
"0","    z"
"0","}"
"0",""
"0","set.seed(1)"
"0","N <- 500"
"0","data <- tibble(x     = runif(N),"
"0","               ytrue = f(x),"
"0","               ycent = ytrue - mean(ytrue),"
"0","               yobs  = ycent + rnorm(N, sd = 0.5))"
"0",""
"0","k <- 10"
"0","knots <- with(data, list(x = seq(min(x), max(x), length = k)))"
"0","sm <- smoothCon(s(x, k = k, bs = ""cr""), data = data, knots = knots)[[1]]$X"
"0","colnames(sm) <- levs <- paste0(""f"", seq_len(k))"
"0","basis <- pivot_longer(cbind(sm, data), -(x:yobs), names_to = 'bf')"
"0","basis"
